# Project Automation Scripts

Этот проект предоставляет набор скриптов на Python, предназначенных для автоматизации различных задач, в основном ориентированных на взаимодействие с Figma и Jira.

## Первоначальная Настройка (Обязательно для большинства скриптов)

1.  **Создайте Файл Конфигурации**:
    Скопируйте шаблон для создания вашего локального файла конфигурации:
    ```bash
    cp config_template.py config.py
    ```
    Затем отредактируйте `config.py` и заполните все необходимые значения (API-ключи, URL Jira, ключи проектов и т.д.). Обратитесь к `config_template.py` за подробной информацией о переменных, необходимых для каждого скрипта.

2.  **Установите Зависимости и Настройте Права Доступа**:
    Запустите скрипт установки. Это установит необходимые пакеты Python (такие как `requests`, `urllib3`) и сделает основные скрипты Python исполняемыми.
    ```bash
    ./setup.sh
    ```

## Доступные Скрипты и Рабочие Процессы

### 1. Дизайны Figma в Тест-кейсы Jira (`send_figma_tests_all_tests.py`)

Этот скрипт обрабатывает файл Figma, извлекает информацию об экранах и элементах и автоматически создает соответствующие задачи типа "Тест" в Jira.

**Ключевая Конфигурация (в `config.py`):**
*   `FIGMA_FILE_URL`: URL вашего файла Figma.
*   `FIGMA_TOKEN`: Ваш персональный токен доступа Figma.
*   `JIRA_URL`, `JIRA_PROJECT_KEY`, `JIRA_USERNAME`, `JIRA_PASSWORD`: Данные вашего экземпляра Jira.
*   `ISSUE_TYPE`: Тип задачи Jira для тестов (например, "Test").
*   `XRAY_STEPS_FIELD`: ID пользовательского поля для шагов теста Xray, если вы используете Xray.
*   `OPERATIONAL_MODE`: Определяет вывод скрипта.
    *   `"JIRA_EXPORT"` (По умолчанию): Создает задачи непосредственно в Jira и прикрепляет изображения.
    *   `"FILE_EXPORT"`: Не создает задачи Jira. Вместо этого генерирует текстовый файл с данными тест-кейсов (название, описание, шаги и т.д.), разделенными точкой с запятой. Изображения все равно загружаются.
        *   `TEXT_EXPORT_PATH`: Директория, в которую будет сохранен текстовый файл (по умолчанию: `create_final_tests/artifacts`).
        *   `TEXT_EXPORT_FILENAME_TEMPLATE`: Шаблон имени файла для экспортированного текстового файла (по умолчанию: `tests_from_figma_runid_{RUN_ID}.txt`).
        *   **Важно для режима `"FILE_EXPORT"`**: После генерации основного файла с тест-кейсами, скрипт автоматически запускает `create_final_tests/create_final_promt.py` и пытается открыть сгенерированный им файл `final_promt.txt` (ожидается в директории, указанной `TEXT_EXPORT_PATH`). **Убедитесь, что все необходимые артефакты для `create_final_promt.py` (например, шаблоны, исходные текстовые файлы) находятся в правильных местах (обычно в `create_final_tests/artifacts/` или согласно конфигурации `create_final_promt.py`), и что все конфигурационные файлы (`config.py`, `config_artifacts.json`) обновлены для корректной работы всего процесса.**
*   `JIRA_LABELS`: Необязательный список глобальных меток для добавления к задачам Jira.
*   Опции фильтрации, такие как `FRAME_LIMIT`, `ELEMENT_BANNED`, `FRAME_BANNED` и т.д., для контроля над тем, какие элементы Figma обрабатываются.

**Как Запустить:**
После завершения первоначальной настройки и конфигурации `config.py` с вашим токеном Figma и данными Jira:
```bash
./send_figma_tests_all_tests.py
```
или
```bash
python3 send_figma_tests_all_tests.py
```

**Результаты Выполнения:**
*   **Если `OPERATIONAL_MODE` равен `"JIRA_EXPORT"`:**
    *   Тестовые задачи, созданные в вашем проекте Jira.
    *   Текстовый файл (`figma_screens/<RUN_ID>/jira_issues_run_<RUN_ID>.txt`), содержащий прямые ссылки на созданные задачи Jira.
*   **Если `OPERATIONAL_MODE` равен `"FILE_EXPORT"`:**
    *   Текстовый файл с данными тест-кейсов, разделенными точкой с запятой, сохраненный по пути, определенному `TEXT_EXPORT_PATH` и `TEXT_EXPORT_FILENAME_TEMPLATE`.
    *   Автоматически запускается скрипт `create_final_tests/create_final_promt.py`.
    *   Предпринимается попытка открыть сгенерированный файл `final_promt.txt` (путь к файлу зависит от `TEXT_EXPORT_PATH`, по умолчанию `create_final_tests/artifacts/final_promt.txt`).
*   **Общее для обоих режимов:**
    *   Изображения экранов/элементов Figma, сохраненные в директории `figma_screens/<RUN_ID>/`.
    *   Логи выполнения записываются в `figma_to_jira.log`, а также выводятся в консоль.

### 2. Генерация Промтов из Артефактов (`create_final_tests/create_final_promt.py`)

Этот вспомогательный скрипт генерирует текстовый файл (например, подробный промт для LLM или сложную конфигурацию), заполняя файл-шаблон содержимым из различных указанных файлов-артефактов.

**Конфигурация (`config_artifacts.json`):**
Этот скрипт требует отдельного конфигурационного файла JSON, обычно называемого `config_artifacts.json`, размещенного в корневой директории проекта. Этот файл определяет:
    *   `prompt_template_path`: Путь к файлу-шаблону.
    *   `output_prompt_path`: Путь, по которому будет сохранен сгенерированный файл (например, `create_final_tests/artifacts/final_promt.txt`).
    *   `artifacts`: Словарь, сопоставляющий ключи с путями к файлам содержимого (артефактам).
    *   `placeholders`: Словарь, сопоставляющий те же ключи (из `artifacts`) со строками-заполнителями в файле-шаблоне, которые будут заменены содержимым соответствующего артефакта.

    *Пример структуры `config_artifacts.json`:*
    ```json
    {
        "prompt_template_path": "create_final_tests/templates/my_template.txt",
        "output_prompt_path": "create_final_tests/artifacts/final_promt.txt",
        "artifacts": {
            "section_one_content": "create_final_tests/source_material/section1_data.txt",
            "section_two_content": "create_final_tests/source_material/section2_data.md"
        },
        "placeholders": {
            "section_one_content": "{{SECTION_ONE_PLACEHOLDER}}",
            "section_two_content": "{{SECTION_TWO_PLACEHOLDER}}"
        }
    }
    ```
    *(Убедитесь, что пути и имена заполнителей соответствуют вашим фактическим файлам и шаблону.)*

**Как Запустить:**
1.  Создайте и настройте ваш `config_artifacts.json`.
2.  Убедитесь, что ваш файл-шаблон и все файлы-артефакты существуют по указанным путям.
3.  Выполните скрипт:
    ```bash
    python3 create_final_tests/create_final_promt.py
    ```

**Результаты Выполнения:**
*   Сгенерированный текстовый файл по пути, указанному `output_prompt_path` в `config_artifacts.json`.
*   Информационные сообщения (об успехе или ошибке), выведенные в консоль.

### 3. Отправка Тест-кейсов в Jira из Файла (`send_final_tests.py`)

Этот скрипт читает тест-кейсы из структурированного текстового файла (похожего на CSV, с использованием точки с запятой в качестве разделителя) и создает соответствующие задачи в Jira. Он предназначен для интеграции с Xray Test Management путем заполнения шагов теста, если соответствующее пользовательское поле Xray настроено в `config.py`.

**Конфигурация (в `config.py`):**
Убедитесь, что следующие параметры правильно установлены в вашем `config.py` для этого скрипта:
*   `JIRA_URL`
*   `JIRA_PROJECT_KEY`
*   `JIRA_USERNAME`
*   `JIRA_PASSWORD`
*   `ISSUE_TYPE` (например, "Test" или ваш тип задачи Xray Test)
*   `XRAY_STEPS_FIELD` (ID пользовательского поля для шагов теста Xray, например, `customfield_10001`. Это крайне важно для интеграции с Xray.)
*   Необязательно, `JIRA_LABELS`: Список меток по умолчанию, которые будут добавлены к каждой созданной задаче (например, `["q3-release", "smoke-test"]`).

**Формат Входного Файла (`create_final_tests/artifacts/final_tests.txt`):**
Скрипт ожидает текстовый файл по пути `create_final_tests/artifacts/final_tests.txt`. Этот файл должен:
*   Быть разделен точкой с запятой (`;`).
*   Включать строку заголовка в качестве первой строки.
*   Содержать следующие столбцы (имена столбцов чувствительны к регистру, как они используются в скрипте):
    *   `TestCaseIdentifier`: Уникальный идентификатор тест-кейса (например, "TC-001").
    *   `Summary`: Заголовок задачи Jira (Обязательно для каждого тест-кейса).
    *   `Description`: Подробное описание для задачи Jira.
    *   `Priority`: Приоритет теста (например, "High", "Medium"). Будет преобразован в метку (например, `Priority_High`).
    *   `Labels`: Список дополнительных пользовательских меток, разделенных запятыми.
    *   `Action`: Описание "Действия" или "Шага" для шага теста Xray.
    *   `Data`: "Данные" для шага теста Xray.
    *   `ExpectedResult`: "Ожидаемый результат" для шага теста Xray.
    *   `Board`: Значение, которое будет использоваться в качестве дополнительной метки (например, название спринта или командной доски).

**Как Запустить:**
После завершения первоначальной настройки и соответствующей конфигурации `config.py`:
```bash
./send_final_tests.py
```
или
```bash
python3 send_final_tests.py
```
*(Убедитесь, что `send_final_tests.py` является исполняемым, если используете метод `./`; `setup.sh` должен это обеспечить.)*

**Результаты Выполнения:**
*   Задачи Jira, созданные в проекте, указанном в `config.py`.
*   Ссылка с JQL-запросом на все успешно созданные задачи выводится в консоль, а также записывается в `send_final_tests.log`. Это позволяет легко просматривать созданные задачи в Jira.
*   Подробные логи выполнения записываются в `send_final_tests.log`, а также выводятся в консоль.

## Используемые Фреймворки и Библиотеки
* Python 3.9+
* requests 2.31+
* urllib3 1.26.17+
